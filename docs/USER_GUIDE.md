# 學生座位安排系統 - 操作指南

## 📋 目錄
1. [基本設定](#基本設定)
2. [匯入學生](#匯入學生)
3. [手動安排座位](#手動安排座位)
4. [自動排座](#自動排座)
5. [視角切換](#視角切換)
6. [座位控制](#座位控制)
7. [儲存與匯入](#儲存與匯入)

---

## 基本設定

### 調整教室座位數
1. 在上方控制面板設定「行數」和「列數」
   - 行數 = 橫向座位數（預設 6 行）
   - 列數 = 縱向座位數（預設 5 列）
2. 點擊「更新座位格」按鈕
3. ⚠️ 注意：更新座位格會清空所有安排

---

## 匯入學生

### CSV 格式
準備一個 CSV 檔案，格式如下：
```
1,王小明,男
2,李小華,女
3,張大同,男
```
- 第一欄：座號
- 第二欄：姓名
- 第三欄：性別（男/女 或 M/F 或 male/female）

### 匯入步驟
1. 點擊「選擇檔案」按鈕
2. 選擇您的 CSV 檔案
3. 點擊「匯入」按鈕
4. 左側學生名單會顯示所有學生

---

## 手動安排座位

### 方法 1：拖曳學生到座位
1. 從左側學生名單拖曳學生
2. 拖到右側座位表的任一座位
3. 放開滑鼠 ✅
4. **效果**：
   - 學生被安排到該座位
   - 座位自動鎖定 🔒（橘色邊框）
   - 學生從名單中消失

### 方法 2：取消座位安排
1. 從座位拖曳學生
2. 拖回左側學生名單區域（藍色高亮）
3. 放開滑鼠 ✅
4. **效果**：
   - 學生回到名單
   - 座位解除鎖定 🔓
   - 座位變為空位

### 方法 3：座位間互相移動
1. 拖曳座位上的學生
2. 拖到另一個座位
3. **效果**：兩位學生交換位置（或移動到空位）

### 視覺提示
- 🟢 **綠色邊框**：可以放置
- 🔴 **紅色邊框**：不能放置（禁用/已鎖定）
- 🔵 **藍色高亮**：拖到學生名單可取消安排

---

## 自動排座

系統提供兩種自動排座模式：

### 🎲 隨機排座
- **功能**：隨機分配所有未鎖定的座位
- **智能保留**：自動檢測並保留鎖定座位
  - 有鎖定座位 → 只排列未鎖定的學生
  - 無鎖定座位 → 全部學生隨機排列
- **排座順序**：按「排」順序填入
  - 第1排從第1位到最後1位
  - 然後第2排從第1位到最後1位
  - 依此類推
- **適合**：不需特別考慮性別分布

### 👥 男女隔開排座
- **功能**：男女生儘量交替排列
- **智能保留**：自動檢測並保留鎖定座位
- **起始性別**：
  - 男生多 → 從男生開始
  - 女生多 → 從女生開始
  - 人數相等且第一個位置已鎖定 → 從該性別開始
  - 人數相等且無鎖定 → 從男生開始
- **衝突檢測**：如果鎖定座位與預期性別衝突，會詢問是否繼續
- **適合**：希望男女生分散坐

### 使用步驟
1. （可選）先手動安排需要特別照顧的學生
   - 拖曳學生到座位 → 自動鎖定
2. 點擊對應的排座按鈕
   - 🎲 隨機排座
   - 👥 男女隔開排座
3. 系統會自動保留所有鎖定座位
4. 未鎖定的座位會自動分配學生

### 排座完成提示
系統會顯示詳細的完成訊息：
- 無鎖定座位：「已完成隨機排座」
- 有鎖定座位：「已完成隨機排座（保留 3 個鎖定座位）」
- 讓您清楚了解系統做了什麼

### ⚠️ 注意事項
- 兩種排座模式都會自動保留鎖定座位
- 不需要手動選擇「保留固定座位」模式
- 鎖定座位的學生永遠不會被移動

---

## 視角切換

系統提供兩種視角模式：

### 📐 黑板在下方（預設）
```
[座位區]
[第1排  第2排  第3排  第4排  第5排]
(下→上) (下→上) (下→上) (下→上) (下→上)
[📋 黑板/講台]
```
- 最左邊 = 第 1 排
- 每排從下往上數

### 📐 黑板在上方
```
[📋 黑板/講台]
[第5排  第4排  第3排  第2排  第1排]
(上→下) (上→下) (上→下) (上→下) (上→下)
[座位區]
```
- 最右邊 = 第 1 排
- 每排從上往下數

### 切換方法
1. 在上方控制面板選擇「視角」
2. 選擇「黑板在下」或「黑板在上」
3. **效果**：
   - 座位自動重新排列
   - 學生位置會跟著視角調整
   - 排數標籤自動更新

---

## 座位控制

每個座位右上角有兩個控制按鈕：

### 🔒 鎖定按鈕
**功能**：鎖定座位，防止自動排座時被更改

**使用時機**：
- 手動安排的學生（自動鎖定）
- 想保留的特定座位

**操作**：
- 點擊一次 = 鎖定（橘色邊框）
- 再點一次 = 解除鎖定
- ⚠️ 空座位無法鎖定

**效果**：
- 自動排座時，鎖定座位的學生不會移動
- 其他學生無法拖曳到鎖定座位

### 🚫 禁用按鈕
**功能**：禁用座位，該位置不安排學生

**使用時機**：
- 教室有柱子或障礙物
- 某些座位不適合使用

**操作**：
- 點擊一次 = 禁用（灰色，半透明）
- 再點一次 = 啟用

**效果**：
- 自動排座時會跳過禁用座位
- 無法拖曳學生到禁用座位
- 禁用座位會自動清空學生並解除鎖定

---

## 儲存與匯入

### 💾 匯出座位表
1. 點擊「💾 匯出座位表」按鈕
2. 系統會下載一個 JSON 檔案
3. **包含內容**：
   - 教室行列數
   - 學生名單
   - 座位安排
   - 鎖定座位
   - 禁用座位
   - 當前視角

### 📂 匯入座位表
1. 點擊「📂 匯入座位表」按鈕
2. 選擇之前匯出的 JSON 檔案
3. **效果**：完整還原之前的狀態

### 其他清除功能

#### 🧹 清空座位
- 清空所有學生的座位安排
- 解除所有鎖定和禁用
- 學生名單保留

#### ⚠️ 清空所有資料
- 清空學生名單
- 清空座位安排
- 所有設定重置
- ⚠️ 此操作無法復原！

---

## 💡 使用技巧

### 技巧 1：手動 + 自動混合使用
```
最佳實踐流程：
1. 先手動拖曳需要特別照顧的 5 位學生到前排
   → 這 5 個座位自動鎖定 🔒
2. 點擊「👥 男女隔開排座」或「🎲 隨機排座」
   → 系統自動保留鎖定的 5 位，只排剩下的 25 位
3. 提示：「已完成排座（保留 5 個鎖定座位）」
```

### 技巧 2：控制男女排座方向
```
當男女人數相等時：
- 想從男生開始 → 鎖定第一個位置為男生
- 想從女生開始 → 鎖定第一個位置為女生
- 系統會自動從鎖定的性別開始排座
```

### 技巧 3：快速調整個別座位
```
排座結果不滿意時：
1. 不要清空座位（會失去已排好的結果）
2. 直接拖曳調整個別學生位置
3. 或：
   - 鎖定滿意的部分
   - 拖回不滿意的學生到名單
   - 重新執行自動排座
```

### 技巧 4：多次排座對比
```
找出最佳方案：
1. 執行「男女隔開排座」
2. 點擊「💾 匯出座位表」（儲存為「方案A.json」）
3. 點擊「🧹 清空座位」（學生回到名單）
4. 再次執行「男女隔開排座」（得到不同結果）
5. 點擊「💾 匯出座位表」（儲存為「方案B.json」）
6. 對比兩個方案，選擇較好的
7. 點擊「📂 匯入座位表」載入最佳方案
```

### 技巧 5：視角切換不影響鎖定
```
安心切換視角：
- 切換「黑板在下」↔「黑板在上」
- 鎖定狀態會自動跟著學生移動 ✅
- 禁用座位也會對應到正確位置 ✅
- 不會丟失任何設定
```

### 技巧 6：取消學生安排的方法
```
方法 1：拖回名單
- 從座位拖曳學生到左側學生名單區域
- 學生回到名單 + 座位解除鎖定

方法 2：禁用座位
- 點擊座位的 🚫 按鈕
- 學生自動回到名單 + 座位變禁用

方法 3：清空所有座位
- 點擊「🧹 清空座位」
- 所有學生回到名單
```

---

## ❓ 常見問題

### Q: 為什麼有些座位無法放置學生？
A: 可能是該座位已被鎖定 🔒 或已禁用 🚫。檢查座位右上角的圖示狀態，點擊可解除。

### Q: 點擊「隨機排座」會清空我手動安排的學生嗎？
A: 不會！系統會自動檢測鎖定座位並保留。如果您手動拖曳安排了學生，這些座位會自動鎖定，「隨機排座」只會排列其他未鎖定的座位。

### Q: 「隨機排座」和以前的「保留固定座位排座」有什麼不同？
A: 功能已合併！現在「隨機排座」會自動判斷：
- 有鎖定座位 → 自動保留並排列其他座位
- 無鎖定座位 → 全部隨機排列
不需要再選擇「保留固定座位」模式。

### Q: 自動排座後為什麼有些學生沒被排到？
A: 檢查是否有過多的禁用座位，導致可用座位數少於學生人數。系統會在排座前檢查並提示錯誤。

### Q: 為什麼男女隔開排座沒有完美交替？
A: 可能原因：
1. 男女人數差距太大（例如 20 男 10 女）
2. 有鎖定座位打斷了交替規律
3. 有禁用座位影響排列順序
系統會盡量隔開，但無法保證完美。

### Q: 如何讓特定學生坐在一起？
A: 手動拖曳將他們安排到相鄰座位，並鎖定這些座位（拖曳安排會自動鎖定），這樣自動排座時就不會改變他們的位置。

### Q: 切換視角後，我的鎖定座位會不會亂掉？
A: 不會！系統會自動處理：
- 鎖定狀態跟著學生移動 ✅
- 禁用座位對應到正確的新位置 ✅
- 所有設定都會正確保留

### Q: 如何取消某個學生的座位安排？
A: 三種方法：
1. 拖曳該學生回左側名單區域
2. 點擊該座位的 🚫 按鈕（禁用座位）
3. 點擊「清空座位」（清空全部）

### Q: 禁用座位後，學生去哪了？
A: 學生會自動回到左側的學生名單中，可以重新安排。

### Q: 學生名單顯示「25/30」是什麼意思？
A: 表示總共 30 位學生，還有 25 位未安排座位。已安排的 5 位學生會從名單中消失（但在座位上顯示）。

---

## 🎯 快速上手流程

### 基本流程
1. **準備 CSV** → 匯入學生名單
2. **設定教室** → 調整行列數、選擇視角
3. **選擇模式**：
   - **純自動**：直接點「🎲 隨機排座」或「👥 男女隔開排座」
   - **手動+自動**：
     - 先拖曳特殊學生到指定位置（自動鎖定）
     - 再點排座按鈕（系統自動保留鎖定座位）
4. **微調** → 拖曳個別學生調整位置
5. **儲存** → 匯出座位表

### 推薦流程（適合大多數情況）
```
步驟 1：匯入 30 位學生
步驟 2：手動拖曳 3-5 位需要特別照顧的學生
        → 例如：視力不好、需要前排的學生
        → 這些座位自動鎖定 🔒
步驟 3：點擊「👥 男女隔開排座」
        → 系統提示「已完成排座（保留 5 個鎖定座位）」
步驟 4：檢視結果，如有需要用拖曳微調
步驟 5：滿意後點「💾 匯出座位表」儲存
```

---

**版本**：v2.0  
**更新日期**：2025-10-17  
**更新內容**：
- 合併「隨機排座」和「保留固定座位排座」功能
- 自動排座會智能檢測並保留鎖定座位
- 新增詳細的排座完成提示訊息
- 改進視角切換時的鎖定狀態處理